# =============================================================================
# RustDesk Server Environment Configuration
# =============================================================================
# Copy this file to .env and customize values for your deployment
# Documentation: https://rustdesk.com/docs/en/self-host/

# =============================================================================
# RELAY SERVER CONFIGURATION
# =============================================================================

# Relay server address that hbbs (signal server) connects to
# Format: hostname:port or IP:port
# Default: rustdesk.icvida.com
# Used by: hbbs command via -r flag
RELAY_ADDRESS=rustdesk.icvida.com

# Relay server port (hbbr)
# Default: 21117
# Used when RELAY_ADDRESS doesn't include port
RELAY_PORT=21117

# Always force connections through relay server (bypass direct P2P)
# Valid values: Y (force relay), N (allow P2P when possible)
# Default: N
# Use case: When clients are behind strict NAT/firewall
ALWAYS_USE_RELAY=N

# =============================================================================
# ENCRYPTION CONFIGURATION
# =============================================================================

# Force encrypted connections only
# Valid values: 0 (allow unencrypted), 1 (encrypted only)
# Default: 0
# Security: Set to 1 in production for enhanced security
ENCRYPTED_ONLY=0

# Base64-encoded Ed25519 public key
# Leave empty to auto-generate on first run
# Format: Base64 string
# File location: /data/id_ed25519.pub
# Note: Must provide BOTH KEY_PUB and KEY_PRIV or neither
KEY_PUB=

# Base64-encoded Ed25519 private key
# Leave empty to auto-generate on first run
# Format: Base64 string
# File location: /data/id_ed25519
# Security: Keep this secret! Never commit to version control
# Note: Must provide BOTH KEY_PUB and KEY_PRIV or neither
KEY_PRIV=

# =============================================================================
# PORT CONFIGURATION
# =============================================================================

# hbbr (Relay Server) Ports
HBBR_PORT_21117=21117  # TCP - Relay connections
HBBR_PORT_21119=21119  # TCP - Relay NAT test

# hbbs (Signal Server) Ports
HBBS_PORT_21115=21115  # TCP - NAT type test
HBBS_PORT_21116_TCP=21116  # TCP - ID registration & heartbeat
HBBS_PORT_21116_UDP=21116  # UDP - ID registration & heartbeat
HBBS_PORT_21118=21118  # TCP - TCP hole punching

# Override main server port (rendezvous/signal)
# Default: 21116
# Note: Rarely needed, use HBBS_PORT_21116_TCP instead
# PORT=21116

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# SQLite database file path
# Default: Auto-generated in /data directory
# Format: Full path to .db file
# DB_URL=/data/db_v2.sqlite3

# Maximum concurrent database connections
# Default: 1
# Range: 1-100 (adjust based on load)
# Performance: Higher values allow more concurrent operations
MAX_DATABASE_CONNECTIONS=1

# =============================================================================
# BANDWIDTH & PERFORMANCE TUNING
# =============================================================================

# Connection downgrade threshold (quality degradation tolerance)
# Default: 0.66 (66%)
# Range: 0.0-1.0
# When connection quality drops below this threshold, consider downgrading
DOWNGRADE_THRESHOLD=0.66

# Delay before starting connection quality checks (seconds)
# Default: 1800 (30 minutes)
# Range: 0-unlimited
# Prevents premature downgrade of new connections
DOWNGRADE_START_CHECK=1800

# Speed limit for blacklisted/throttled connections (Mbps)
# Default: 32
# Use case: Rate limiting for abusive clients
LIMIT_SPEED=32

# Total bandwidth limit for relay server (Mbps)
# Default: 1024 (1 Gbps)
# Adjust based on server network capacity
TOTAL_BANDWIDTH=1024

# Bandwidth limit per single connection (Mbps)
# Default: 128
# Prevents single connection from monopolizing bandwidth
SINGLE_BANDWIDTH=128

# =============================================================================
# DOCKER IMAGE & RUNTIME
# =============================================================================

# Docker image to use
# Default: rustdesk/rustdesk-server:latest
# Options: latest, specific version tag
RUSTDESK_IMAGE=rustdesk/rustdesk-server:latest

# Rust logging level
# Valid values: error, warn, info, debug, trace
# Default: info
# Debug: Set to debug or trace for troubleshooting
RUST_LOG=info

# =============================================================================
# TESTING & DEVELOPMENT
# =============================================================================

# Test address for hbbs server validation
# Default: Empty (no test)
# Format: IP:port
# Use case: Internal testing/validation
# TEST_HBBS=

# =============================================================================
# DOCKER SECRETS (Alternative to Environment Variables)
# =============================================================================
# Instead of KEY_PUB/KEY_PRIV env vars, you can use Docker secrets:
# - /run/secrets/key_pub  → /data/id_ed25519.pub
# - /run/secrets/key_priv → /data/id_ed25519
# Priority: Docker secrets > Environment variables > Auto-generation

# =============================================================================
# SECURITY NOTES
# =============================================================================
# 1. Never commit .env file with real credentials to version control
# 2. Use KEY_PRIV carefully - it's equivalent to server private key
# 3. Set ENCRYPTED_ONLY=1 in production environments
# 4. Rotate keys periodically using rustdesk-utils genkeypair
# 5. Restrict file permissions on .env (chmod 600 .env)
# 6. Use Docker secrets in production for KEY_PUB/KEY_PRIV

# =============================================================================
# GENERATE NEW KEYS
# =============================================================================
# To generate a new key pair:
#   docker compose exec hbbs rustdesk-utils genkeypair
# Or with binary:
#   ./rustdesk-utils genkeypair
# To validate existing key pair:
#   ./rustdesk-utils validatekeypair <public_key> <private_key>

# =============================================================================
# TYPICAL DEPLOYMENT SCENARIOS
# =============================================================================

# Scenario 1: Simple Local Testing
# RELAY_ADDRESS=localhost
# ENCRYPTED_ONLY=0
# (leave keys empty for auto-generation)

# Scenario 2: Production with Custom Domain
# RELAY_ADDRESS=relay.yourcompany.com
# ENCRYPTED_ONLY=1
# KEY_PUB=<your_base64_public_key>
# KEY_PRIV=<your_base64_private_key>
# RUST_LOG=warn

# Scenario 3: High-Security Environment
# RELAY_ADDRESS=relay.yourcompany.com
# ENCRYPTED_ONLY=1
# ALWAYS_USE_RELAY=Y
# (use Docker secrets for keys)
# RUST_LOG=info
